# 多机实验说明文档

## 网络连接

这里感谢黄海龙老师和黄海龙老师课题组学生购置的高性能低延迟路由器。
路由器本来是他们自己实验用的，现在他们允许我们一起使用，十分感谢。
这个新的路由器的通信延迟平均在 7ms 左右，偶尔几十毫秒。

- 我的笔记本电脑

    实验时，我的笔记本电脑需要用网线连接到路由器，此时我的 IP 地址为: **192.168.50.172**

    若我的笔记本连接的是 wifi，那么我的 IP 地址为: **192.168.50.35**

- VICON

    实验室的 VCION 动作捕捉系统在这个路由器下边的 IP 地址为: **192.168.50.142**

- 无人机

    目前一共有三架无人机连接到这个路由器，它们的名字和 IP 地址分别为:

  | 设备名称          | IP地址           |
  |---------------|----------------|
  | gh034_alpha   | 未设置            |
  | gh034_bravo   | 192.168.50.149 |
  | gh034_charlie | 192.168.50.183 |
  | gh034_delta   | 192.168.50.125 |

  另: 实验中，将 0, 1, 2, 3 四个无人机分别定义为: gh034_charlie, gh034_delta, gh034_bravo, gh034_alpha

## 无人机与 QGC 的连接

实际上，如果能保证无人机不出现连接和模式切换错误的话，可以不使用 QGC 的。
但是考虑到无人机的连接经常会出现问题, 比如电池电压过低，加速度计异常，等等。
因此还是连接 QGC 比较稳妥。

然而，QGC 默认的端口是 14550，所以如果不进行人为设置的话，多台飞机会连接到同一个 QGC；因此，这里记录一下如何设置。

在文件夹 master/launch/mavros_launch/ 中，打开任意一个 launch 文件，找到

`<arg name="gcs_url" default="udp://:14550@192.168.50.172:14550" />`

这里面 "172" 就是要广播的地面站电脑的 IP 地址，“14550” 就是端口号。
所以，只需要在执行的时候把 IP 和 端口号做对应的修改就行。修改过后，还需要在 QGC 这个软件里面做对应修改。

打开 QGC，点击左上角的小图标
1. 选择 "Application Settings"，进入选择 "general"
2. 往下滑，有一个 “AutoCOnnect to the following devices”，把里面的 UDP 的对号取消
3. 左侧栏，选择 "Comm Links"，点击下边出现的 "Add"
4. Name 随便写，Type 选择 UDP (默认是 serial)，然后端口选择刚才指定的，点击 OK
 
Tips: 实际使用时，在执行过 consensus_uav*_mavros.launch 之后，需要在 QGC 进入这个界面，点击下边的连接，才能连上。
并且，记住在实验过后，要把这些设置还原才行，否则以后连不上了。

## 实验时
实验时，我的笔记本是主机，将 WiFi 关掉，连接网线，这时我的 IP 是 192.168.50.172 (前边提到过)。

1. 打开我电脑的终端，进入 .bashrc，输入以下指令

    ```
    忘了，晚上再说
    ```
    保存关闭，然后执行 source .bashrc

2. 打开终端，执行 roscore，这时已经打开了整个多机 ROS 的工作空间，实验全程，我的 roscore 不能关
3. 为每一架飞机单独执行程序，所以需要进入多个 docker，自己分清楚别乱了就行。
   
    3.1 未完待续......
